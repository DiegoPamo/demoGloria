{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="wrappixel, admin dashboard, html css dashboard, web dashboard, bootstrap 4 admin, bootstrap 4, css3 dashboard, bootstrap 4 dashboard, material admin bootstrap 4 dashboard, frontend, responsive bootstrap 4 admin template, material design, material dashboard bootstrap 4 dashboard template">
    <meta name="description" content="MaterialPro is powerful and clean admin dashboard template, inpired from Google's Material Design">
    <meta name="robots" content="noindex,nofollow">
    <title>Dashboard Gloria</title>
    <link rel="canonical" href="https://www.wrappixel.com/templates/materialpro/" />
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/favicon.png">
    <!-- This Page CSS -->
    <!-- Custom CSS -->

    <link href="{% static 'dist/css/style.min.css' %}" rel="stylesheet">
    <link href="{% static 'dist/css/chartStyle.css' %}" rel="stylesheet">

</head>

<body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">
        <!-- ====================================================== ======== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->
        {% include 'components/navbar.html'%}
        <!-- ============================================================== -->
        <!-- End Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Page wrapper  -->
        <!-- ============================================================== -->
        <div class="page-wrapper">
            <div class="row page-titles">
                <div class="col-md-5 col-12 align-self-center">
                    <h3 class="text-themecolor mb-0">Dashboard control contenido neto</h3>
                    <ol class="breadcrumb mb-0 p-0 bg-transparent">
                        <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                        <li class="breadcrumb-item active">Listado de registros</li>
                    </ol>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <!-- Contenedor principal -->
                <!-- Contenedor principal -->
                <div class="container-fluid">
                    <div class="row">
                    <!-- Columna de la tabla -->
                    <div class="col-md-8">
                        <div class="card">
                        <div class="card-body">
                            <h4>LISTADO DE REGISTROS</h4>
                            <div class="input-group mb-3">
                                <input type='text' name="daterange" class="form-control daterange" />
                            </div>

                            <table id="tabla-datos" class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Turno</th>
                                    <th>Operador</th>
                                    <th>Promedio Muestras</th>
                                    <th>Margen de Error</th>
                                    <th>Observaciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dato in registros %}
                                    <tr data-id="{{ dato.id }}">
                                        <td>{{dato.fecha|date:"Y-m-d"}}</td>
                                        <td>{{dato.turno}}</td>
                                        <td>{{dato.operador}}</td>
                                        <td>{{dato.promedio_final}}</td>
                                        <td>{{dato.margen_error}}</td>
                                        <td>{{dato.observaciones}}</td>
                                        <td hidden>{{dato.promedio}}</td>
                                        <td hidden>{{dato.rango}}</td>
                                    </tr>
                                {% endfor %}
                                <!-- Agrega más filas de ejemplo aquí -->
                            </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                
                    <!-- Columna de la card con inputs -->
                    <div class="col-md-4">
                        <div class="card" id="card-inputs">
                            <div class="card-body">
                                <h3 class="card-title">Detalles del Registro</h3>
                                <a href="#" id="editar-enlace" class="btn btn-primary">
                                    <i class="fas fa-pencil-alt"></i> Editar
                                </a>
                                <a href="#" id="generar-pdf" class="btn btn-danger" title="Generar PDF">
                                    <i class="fas fa-file-pdf"></i>
                                </a>
                               <div class="form-group">
                                    <label for="fecha">Fecha:</label>
                                    <input type="text" id="fecha" readonly class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="promedio">Promedio Muestras:</label>
                                    <input type="text" id="promedio" readonly class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="margen">Margen de Error:</label>
                                    <input type="text" id="margen" readonly class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="container-fluid">
                    <div class="row">
                        <div class="card col-md-5">
                        <h4>GRAFICO MEDIA MUESTRAS</h4>
                          <div class="demo-container" style="height: 450px;">
                            <div id="grafico" class="flot-chart-content" style="height: 450px; width:550px;"></div>
                          </div>
                        </div>
                        <div class="card col-md-6 ml-3">
                        <h4>GRAFICO RANGO MUESTRAS</h4>
                          <div class="demo-container" style="height: 450px;">
                            <div id="grafico2" class="flot-chart-content" style="height: 450px; width:550px;"></div>
                        </div>
                        </div>
                    </div>
                </div>

                


            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            <footer class="footer">
                © 2023 SUCCESS SDISE - DASHBOARD GLORIA
            </footer>
            <!-- ============================================================== -->
            <!-- End footer -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Page wrapper  -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- customizer Panel -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- All Jquery -->
    <!-- ============================================================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js"></script>

    <script src="{% static 'src/assets/libs/jquery/dist/jquery.min.js' %}"></script>



    <!-- Bootstrap tether Core JavaScript -->
    <script src="{% static 'src/assets/libs/popper.js/dist/umd/popper.min.js' %}"></script>
    <script src="{% static 'src/assets/libs/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <!-- apps -->
    <script src="{% static 'dist/js/app.min.js' %}"></script>
    <script src="{% static 'dist/js/app.init.js' %}"></script>
    <script src="{% static 'dist/js/app-style-switcher.js' %}"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="{% static 'src/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js' %}"></script>
    <script src="{% static 'src/assets/extra-libs/sparkline/sparkline.js' %}"></script>
    <!--Wave Effects -->
    <script src="{% static 'dist/js/waves.js' %}"></script>
    <!--Menu sidebar -->
    <script src="{% static 'dist/js/sidebarmenu.js' %}"></script>
    <!--Custom JavaScript -->
    <script src="{% static 'dist/js/custom.min.js' %}"></script>
    <script src="{% static 'src/assets/libs/moment/min/moment.min.js' %}"></script>
    <script src="{% static 'src/assets/libs/daterangepicker/daterangepicker.js' %}"></script>
    <link rel="stylesheet" href="{% static 'src/assets/libs/daterangepicker/daterangepicker.css' %}">


    <script>
        $(document).ready(function() {
            // Cuando se haga clic en una fila de la tabla
            $('#tabla-datos tbody tr').on('click', function(event) {
                // Obtener los datos de la fila clickeada
                var fecha = $(this).find('td:eq(0)').text();
                var promedio = $(this).find('td:eq(3)').text();
                var margen = $(this).find('td:eq(4)').text();
                var valores = $(this).find('td:eq(6)').text();
                var valores2 = $(this).find('td:eq(7)').text();

                valores = reemplazarComillas(valores);
                valores2 = reemplazarComillas(valores2);

                actualizarGrafico(valores, 'grafico');
                actualizarGrafico(valores2, 'grafico2');

                // Actualizar los valores de los inputs en la card
                $('#fecha').val(fecha);
                $('#promedio').val(promedio);
                $('#margen').val(margen);

                var id = $(this).data('id');

                // Actualizar el enlace con el ID de la fila seleccionada
                var enlace = "{% url 'edit_register' id=0 %}".replace('0', id);
                var enlacepdf = "{% url 'generar_pdf' id=0 %}".replace('0', id);
                $('#editar-enlace').attr('href', enlace);
                $('#generar-pdf').attr('href', enlacepdf);

            });
        });

        var xAxisData = ['Muestra1', 'Muestra2', 'Muestra3', 'Muestra4', 'Muestra5', 
                        'Muestra6', 'Muestra7', 'Muestra8', 'Muestra9', 'Muestra10',
                        'Muestra11', 'Muestra12', 'Muestra13', 'Muestra14', 'Muestra15', 'Muestra16'];

        function reemplazarComillas(cadena) {
            cadena = cadena.replace(/''/g, '0');
            cadena = cadena.replace(/'/g, '');
            return cadena;
        }

        function actualizarGrafico(datos, graficoId) {
        var myChart = echarts.init(document.getElementById(graficoId));
        var datosParseados = JSON.parse(datos);

        var option = {
            xAxis: {
            type: 'category',
            data: xAxisData,
            axisLabel: {
                rotate: 75,
                interval: 0
            }
            },
            yAxis: {
            type: 'value'
            },
            toolbox: {
            feature: {
                dataZoom: {
                show: true,
                yAxisIndex: false
                },
                restore: {
                show: true
                }
            }
            },
            series: [{
            data: datosParseados,
            type: 'line'
            }]
        };

        myChart.setOption(option);
        }
    </script>

    <!-- CONFIGURACION FECHAS  -->
    <script>
    $(document).ready(function() {
        // Inicializar el datepicker en el input con clase 'daterange'
        $('.daterange').daterangepicker();

        // Manejar el evento de cambio de fecha en el datepicker
        $('.daterange').on('apply.daterangepicker', function(ev, picker) {
            var startDate = picker.startDate.format('YYYY-MM-DD');
            var endDate = picker.endDate.format('YYYY-MM-DD');

            // Ocultar todas las filas de la tabla
            $('#tabla-datos tbody tr').hide();

            // Mostrar solo las filas cuyas fechas están dentro del rango seleccionado
            $('#tabla-datos tbody tr').each(function() {
            var fecha = $(this).find('td:first-child').text();
            if (fecha >= startDate && fecha <= endDate) {
                $(this).show();
            }
            });
        });
    });
    </script>
    
</body>

</html>